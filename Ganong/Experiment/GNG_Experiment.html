<!doctype html>
<html>
    <head>
        <title>GNG Experiment</title>
        
        <!-- Import jsPsych Library & Stylesheet //-->
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="jspsych-5.0.3/jspsych.js"></script>
        <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        
        <!-- Load jsPsych Plugins Here //-->
        

        <script src="jspsych-5.0.3/plugins/jspsych-instructions.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-single-textbox.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-single-audio.js"></script>
        <script src="jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>

        
        
        <style>
			div.centered {
				position: fixed;
				top: 50%;
				left: 50%;
				text-align: center;
  				/* bring your own prefixes */
  				transform: translate(-50%, -50%);
			}
		</style>
        
    </head>
    <body>
    
    <script>

	/* Welcome */
  	var welcome_trial = {
		type: 'single-text',
		questions: ["Welcome to the experiment. Please enter Subject ID and press Submit to begin...."],
		size: 30
	};
	
	/* Instructions Block */

	var instructions_block = {
    	type: 'instructions',
    	pages: [
    	    'Welcome to the experiment. Click next to begin.',
    	    'This is the second page of instructions.',
   	     	'This is the final page.'
   		],
    	show_clickable_nav: true
	};
	
	
	
	/* Parameters */ 
	
	//Here you will specify some values for each continuum.
	//	- contX_voiced: 	the voiced word/non-word for this continuum (e.g., DASH)
	//	- contX_voiceless:	the voiceless word/non-word for this continuum (e.g., TASH)
	//	- contX_stimY:		the path to the each audio file generated by PRAAT for this continuum. Should go in order (1 is shortest VOT, 9 is longest VOT)
	
	
	//Set these values for Continuum 1
	
	cont1_voiced = "DASH";
	cont1_voiceless = "TASH";
	
	cont1_stim1 = "dash-tash_VOT_1.wav";
	cont1_stim2 = "dash-tash_VOT_2.wav";
	cont1_stim3 = "dash-tash_VOT_3.wav";
	cont1_stim4 = "dash-tash_VOT_4.wav";
	cont1_stim5 = "dash-tash_VOT_5.wav";
	cont1_stim6 = "dash-tash_VOT_6.wav";
	cont1_stim7 = "dash-tash_VOT_7.wav";
	cont1_stim8 = "dash-tash_VOT_8.wav";
	cont1_stim9 = "dash-tash_VOT_9.wav";
	
	
	
	
	//
	
	
	
	
	
	
	/* -----------------Continuum1 Block---------------------- */
	
	//Randomize which response is assigned to 1 and which is assigned to 0
	var cont1_push1 = "";
	var cont1_push0 = "";
	
	cont1_coinflip = Math.round(Math.random());
	if (Math.round(Math.random()) == 0) {
		cont1_push1 = cont1_voiced;
		cont1_push0 = cont1_voiceless;
	}
	else {
		cont1_push1 = cont1_voiceless;
		cont1_push0 = cont1_voiced;
	}
	////////////////
	
		
	var continuum1_instructions = {
		type: 'text',
		text: '<div class="centered"><p>In this block, press 1 if you hear '+cont1_push1+' and press 0 if you heard '+cont1_push0+'.</p><p>Press the spacebar to begin.</p>',
		cont_key: [' ']
	}
	
	//Put all of your stimuli here
	var continuum1_stimuli = [
		/*{stimulus: cont1_stim1, data: {step: '1'} },
		{stimulus: cont1_stim2, data: {step: '2'} },
		{stimulus: cont1_stim3, data: {step: '3'} },
		{stimulus: cont1_stim4, data: {step: '4'} },*/
		{stimulus: cont1_stim5, data: {step: '5'} }/*,
		{stimulus: cont1_stim6, data: {step: '6'} },
		{stimulus: cont1_stim7, data: {step: '7'} },
		{stimulus: cont1_stim8, data: {step: '8'} },
		{stimulus: cont1_stim9, data: {step: '9'} }
		*/
	];
	
	//Make 9 copies of each stimulus and randomize them
	//1 for debugging, change to 9 for exp
	var continuum1_stimuli_randomized = jsPsych.randomization.repeat(continuum1_stimuli, 1);

	
	var continuum1_block = {
		type: 'single-audio',
		prompt: '<div class="centered">1/'+cont1_push1+'--------------------------------------------0/'+cont1_push0+'</div>',
		choices: ['1','0'],
		data: { continuum: cont1_voiced+'-'+cont1_voiceless },
		
		timeline: continuum1_stimuli_randomized,
		
		
		on_finish: function(data) {
			var key = String.fromCharCode(data.key_press);
			
			if (key == '1') {
				resp = cont1_push1;
			}
			else if (key == '0') {
				resp = cont1_push0;
     		}
      		jsPsych.data.addDataToLastTrial({response: resp});
    	},	
	};
	
	/* -------------End of Continuum1 Block------------------- */
	
	
	/* TODO
	
	(✓)make a system to randomize the order of the blocks
	(✓)Change the number of stimuli copies to 9
	( )add something to filter out irrelevant trials from the data
	( )comment the code
	( )(last)Make 6 copies of the continuum
	
	*/
	
	
	
	
	//Final Screen
	var final_screen = {
		type: 'text',
		text: '<div class="centered"><p>This is the end of the experiment. Thank you for your participation.</p>' +
				  '<p>Please press any key to end this session and bring up results.</p>'
	};
    
    
    //Fisher-Yates function to randomize the elements in an array
    //from https://www.frankmitchell.org/2015/01/fisher-yates/
    
    function shuffle (array) {
		var i = 0;
		var j = 0;
    	var temp = null;

  		for (i = array.length - 1; i > 0; i -= 1) {
    		j = Math.floor(Math.random() * (i + 1));
    		temp = array[i];
    		array[i] = array[j];
    		array[j] = temp;
  		}
  		return array;
	}
	
	///////////////////////////////////////////////////////////
	
	
    
    //-------- Create the Experiment Timeline ---------//
    var timeline = [];
    //timeline.push(welcome_trial);
    //timeline.push(instructions_block);
    
    
    //Randomize the order in which the test blocks are presented
    var continua = [1,2,3,4,5,6];
    var i;
    continua = shuffle(continua);
    for (i = 0; i < continua.length; i++) {
    	//alert(continua[i]);
    	switch(continua[i]) {
    		case 1:
	    		timeline.push(continuum1_instructions);
	    		timeline.push(continuum1_block);
	    		break;
/*	    	case 2:
	    		timeline.push(continuum2_instructions);
	    		timeline.push(continuum2_block);
	    		break;
	    	case 3:
	    		timeline.push(continuum3_instructions);
	    		timeline.push(continuum3_block);
	    		break;
	    	case 4:
	    		timeline.push(continuum4_instructions);
	    		timeline.push(continuum4_block);
	    		break;
	    	case 5:
	    		timeline.push(continuum5_instructions);
	    		timeline.push(continuum5_block);
	    		break;
	    	case 6:
	    		timeline.push(continuum6_instructions);
	    		timeline.push(continuum6_block);
*/
	    }
    }
    
    timeline.push(final_screen);
    
	//timeline.push(test);
    
    
    jsPsych.init({
        timeline: timeline,
        on_finish: function() {
        	jsPsych.data.displayData();
        }
    })

    </script>
    
    </body>
</html>